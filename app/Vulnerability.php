<?php
namespace App;

Class Vulnerability
{

    public function getAllVulnerabilityQuestions()
    {
        // Create Soap Object
        $client =  (new \App\Repositories\VlaSoap)->ws_init();
        
        $questions = json_decode($client->GetAllQuestionsByCategoryIdasJSON( [ 'CategoryId' => 2 ] )->GetAllQuestionsByCategoryIdasJSONResult, true);

        return $questions;
    }

    public function deleteVulnerabilityByServiceID( $sv_id )
    {
        // Create Soap Object
        $client =  (new \App\Repositories\VlaSoap)->ws_init();
        
        $questions = json_decode($client->DeleteOrbitServiceVulAnswerByService( [ 'ServiceId' => $sv_id ] )->DeleteOrbitServiceVulAnswerByServiceResult, true);

        return $questions;
    }

    public function saveVulnerabilityQuestions( $sv_id, $vul_questions ) 
    {
        // Create Soap Object
        $client =  (new \App\Repositories\VlaSoap)->ws_init();        

        foreach ($vul_questions as $vul_question) 
        {	        	
	        // Create call request        
	        $info = [ 'ObjectInstance' =>  [
												'Answer' => true,
												'Operator' => '=',
												'QuestionId' => $vul_question,
												'ServiceId' => $sv_id,
												'ServiceVulAnsId' => 0,
										    ]
	        		];
	        
	        $response = $client->SaveOrbitServiceVulAnswer( $info );
	        $response->SaveOrbitServiceVulAnswerResult;
        }
    }
}
?>