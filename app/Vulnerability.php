<?php
namespace App;

/**
 * Vulnerability model for the vulnerability question functionalities
 * @author Christian Arevalo
 * @version 1.0.0
 * @see  OrbitSoap
 */
Class Vulnerability extends OrbitSoap
{
    /**
     * Get all vulnerability questions
     * @return array $questions vulnerability questions
     */
    public function getAllVulnerabilityQuestions()
    {
        $questions = json_decode(
                                    $this
                                    ->client
                                    ->ws_init( 'GetAllQuestionsByCategoryIdasJSON' )
                                    ->GetAllQuestionsByCategoryIdasJSON( [ 'CategoryId' => 2 ] )
                                    ->GetAllQuestionsByCategoryIdasJSONResult
                                    , true
                                );

        return $questions;
    }
    /**
     * Delete vulnerability question by service
     * @param  int      $sv_id      service id
     * @return array    $questions
     */
    public function deleteVulnerabilityByServiceID( $sv_id )
    {
        $questions = json_decode(
                                    $this
                                    ->client
                                    ->ws_init( 'DeleteOrbitServiceVulAnswerByService' )
                                    ->DeleteOrbitServiceVulAnswerByService( [ 'ServiceId' => $sv_id ] )
                                    ->DeleteOrbitServiceVulAnswerByServiceResult
                                    , true
                                );

        return $questions;
    }
    /**
     * Create or update vulnerability question
     * @param  int    $sv_id         service id
     * @param  int    $vul_questions vulnerability question id
     * @return array                 save result
     */
    public function saveVulnerabilityQuestions( $sv_id, $vul_questions )
    {
        $info=[];
        foreach ($vul_questions as $vul_question) {
            // Create call request
            $info['ObjectInstance'][] = [
                                                'Answer' => true,
                                                'Operator' => '=',
                                                'QuestionId' => $vul_question,
                                                'ServiceId' => $sv_id,
                                                'ServiceVulAnsId' => 0,
                                            ];
        }
        if(!empty($info)) {
            $response = $this
                        ->client
                        ->ws_init( 'SaveOrbitServiceVulAnswers' )
                        ->SaveOrbitServiceVulAnswers( $info );
            $response->SaveOrbitServiceVulAnswersResult;

        }
    }
}
